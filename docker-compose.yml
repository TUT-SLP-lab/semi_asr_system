version: "3"
services:
    # asr_system:
    #     build:
    #         context: .
    #         dockerfile: docker/asr_system/Dockerfile
    #     image: kinouchi1000/espnet_asr_server
    #     runtime: nvidia
    #     environment:
    #         - NVIDIA_VISIBLE_DEVICES=all
    #     ports:
    #         - "5000:5000"
    #     command: "python run_asr_server.py"
    #     volumes:
    #         - ./src:/app

  mongo:
    image: mongo
    restart: always
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_DB_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_DB_PASSWORD}
    ports:
      - ${MONGO_DB_PORT}:${MONGO_DB_PORT}
    volumes:
      - ./db:/data/db
      - ./configdb:/data/configdb

  mongo-express:
    image: mongo-express
    restart: always
    ports:
      - 8081:8081
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: ${MONGO_DB_USERNAME}
      ME_CONFIG_MONGODB_ADMINPASSWORD: ${MONGO_DB_PASSWORD}
      ME_CONFIG_MONGODB_SERVER: ${MONGO_DB_SERVER}
    depends_on:
      - mongo
  
  dispatcher:
    container_name: dispatcher
    build:
      context: .
      dockerfile: docker/dispatcher/Dockerfile
    ports:
      - ${DISPATCHER_PORT}:${DISPATCHER_PORT}
    environment:
      - MONGO_DB_SERVER
      - MONGO_DB_PORT
    command: "python3 dispatcher.py"
    volumes:
      - ./src/dispatcher:/app
